/*! ui-router-extras - v0.0.11 - 2014-11-21 */(function(e,t,n){function c(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}function h(e){if(Object.keys){return Object.keys(e)}var n=[];t.forEach(e,function(e,t){n.push(t)});return n}function p(e,t){if(Array.prototype.indexOf){return e.indexOf(t,Number(arguments[2])||0)}var n=e.length>>>0,r=Number(arguments[2])||0;r=r<0?Math.ceil(r):Math.floor(r);if(r<0)r+=n;for(;r<n;r++){if(r in e&&e[r]===t)return r}return-1}function d(e,t,n,r){var i=c(n,r),u,a={},f=[];for(var l in i){if(!i[l].params)continue;u=o(i[l].params)?i[l].params:h(i[l].params);if(!u.length)continue;for(var d in u){if(p(f,u[d])>=0)continue;f.push(u[d]);a[u[d]]=e[u[d]]}}return s({},a,t)}function v(e,t){return s(new(s(function(){},{prototype:e})),t)}function g(){m=n}function y(e){var n={};var i={};var s;this.registerStickyState=function(e){i[e.name]=e};this.enableDebug=function(e){r=e};this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(e,i,s,o,a){function f(){var e={};t.forEach(n,function(t,n){var r=l(t);for(var i=0;i<r.length;i++){var s=r[i].parent;e[s.name]=e[s.name]||[];e[s.name].push(t)}if(e[""]){e["__inactives"]=e[""]}});return e}function l(e){var t=[];if(!e)return t;do{if(e.sticky)t.push(e);e=e.parent}while(e);t.reverse();return t}function c(e,t,n){if(e[n]===t[n])return{from:false,to:false};var r=n<e.length&&e[n].self.sticky;var i=n<t.length&&t[n].self.sticky;return{from:r,to:i}}function h(e,t,r){if(r)return"updateStateParams";var i=n[e.self.name];if(!i)return"enter";var s=v(t,i.locals.globals.$stateParams,e.ownParams);return s?"reactivate":"updateStateParams"}function p(e,t){var r=n[e.name];if(!r)return null;if(!t)return r;var i=v(t,r.locals.globals.$stateParams,e.ownParams);return i?r:null}function v(e,t,n){if(!n){n=[];for(var r in e)n.push(r)}for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!=t[s])return false}return true}var m={getInactiveStates:function(){var e=[];t.forEach(n,function(t){e.push(t)});return e},getInactiveStatesByParent:function(){return f()},processTransition:function(e){var n={inactives:[],enter:[],exit:[],keep:0};var r=e.fromState.path,o=e.fromParams,a=e.toState.path,l=e.toParams,p=e.options;var m=0,g=a[m];if(p.inherit){l=d(s,l||{},i.$current,e.toState)}while(g&&g===r[m]&&v(l,o,g.ownParams)){g=a[++m]}n.keep=m;var y,b,w,E={},S=c(r,a,m);var x=false;for(y=m;y<a.length;y++){var T=!S.to?"enter":h(a[y],e.toParams,x);x=x||T=="updateStateParams";n.enter[y]=T;if(T=="reactivate")w=E[a[y].name]=a[y];if(T=="updateStateParams")b=a[y]}w=w?w.self.name+".":"";b=b?b.self.name+".":"";var N=f();var C=[""].concat(u(r.slice(0,m),function(e){return e.self.name}));t.forEach(C,function(e){var t=N[e];for(var r=0;t&&r<t.length;r++){var i=t[r];if(!E[i.name]&&(!w||i.self.name.indexOf(w)!==0)&&(!b||i.self.name.indexOf(b)!==0))n.inactives.push(i)}});for(y=m;y<r.length;y++){var k="exit";if(S.from){n.inactives.push(r[y]);k="inactivate"}n.exit[y]=k}return n},stateInactivated:function(e){n[e.self.name]=e;e.self.status="inactive";if(e.self.onInactivate)o.invoke(e.self.onInactivate,e.self,e.locals.globals)},stateReactivated:function(e){if(n[e.self.name]){delete n[e.self.name]}e.self.status="entered";if(e.self.onReactivate)o.invoke(e.self.onReactivate,e.self,e.locals.globals)},stateExiting:function(e,i,s){var u={};t.forEach(i,function(e){u[e.self.name]=true});t.forEach(n,function(i,s){if(!u[s]&&i.includes[e.name]){if(r)a.debug("Exiting "+s+" because it's a substate of "+e.name+" and wasn't found in ",u);if(i.self.onExit)o.invoke(i.self.onExit,i.self,i.locals.globals);t.forEach(i.locals,function(e,t){delete T.locals[t]});i.locals=null;i.self.status="exited";delete n[s]}});if(s)o.invoke(s,e.self,e.locals.globals);e.locals=null;e.self.status="exited";delete n[e.self.name]},stateEntering:function(e,t,n){var r=p(e);if(r&&!p(e,t)){var i=e.locals;this.stateExiting(r);e.locals=i}e.self.status="entered";if(n)o.invoke(n,e.self,e.locals.globals)},reset:function(n,r){var s=i.get(n);var o=p(s,r);if(!o)return false;m.stateExiting(o);e.$broadcast("$viewContentLoading");return true}};return m}]}function C(e){return{resolve:{},locals:{globals:E&&E.locals&&E.locals.globals},views:{},self:{},params:{},ownParams:N.hasParamSet?{$$equals:function(){return true}}:[],surrogateType:e}}function k(e,n,r){function i(e,t,n){return e[t]?e[t].toUpperCase()+": "+n.self.name:"("+n.self.name+")"}var s=u(r.inactives,function(e){return e.self.name});var o=u(n.toState.path,function(e,t){return i(r.enter,t,e)});var a=u(n.fromState.path,function(e,t){return i(r.exit,t,e)});var f=n.fromState.self.name+": "+t.toJson(n.fromParams)+": "+" -> "+n.toState.self.name+": "+t.toJson(n.toParams);e.debug("   Current transition: ",f);e.debug("Before transition, inactives are:   : ",u(b.getInactiveStates(),function(e){return e.self.name}));e.debug("After transition,  inactives will be: ",s);e.debug("Transition will exit:  ",a);e.debug("Transition will enter: ",o)}function L(e,t,n){e.debug("Current state: "+t.self.name+", inactive states: ",u(b.getInactiveStates(),function(e){return e.self.name}));var r=function(e,t){return"'"+t+"' ("+e.$$state.name+")"};var i=function(e,t){return t!="globals"&&t!="resolve"};var s=function(e){var t=u(l(e.locals,i),r).join(", ");return"("+(e.self.name?e.self.name:"root")+".locals"+(t.length?": "+t:"")+")"};var o=s(t);var a=t.parent;while(a&&a!==t){if(a.self.name===""){o=s(n.$current.path[0])+" / "+o}o=s(a)+" / "+o;t=a;a=t.parent}e.debug("Views: "+o)}t.module("ct.ui.router.extras",["ui.router"]);var r=false;var i=t.forEach;var s=t.extend;var o=t.isArray;var u=function(e,t){"use strict";var n=[];i(e,function(e,r){n.push(t(e,r))});return n};var a=function(e){"use strict";return u(e,function(e,t){return t})};var f=function(e,t){"use strict";var n=[];i(e,function(e,r){if(t(e,r)){n.push(e)}});return n};var l=function(e,t){"use strict";var n={};i(e,function(e,r){if(t(e,r)){n[r]=e}});return n};var m;t.module("ct.ui.router.extras").config(["$provide",function(e){var t;e.decorator("$state",["$delegate","$q",function(e,n){t=e.transitionTo;e.transitionTo=function(r,i,s){if(s.ignoreDsr){m=s.ignoreDsr}return t.apply(e,arguments).then(function(e){g();return e},function(e){g();return n.reject(e)})};return e}])}]);t.module("ct.ui.router.extras").service("$deepStateRedirect",["$rootScope","$state","$injector",function(e,r,i){function f(e){var t=e.name;if(o.hasOwnProperty(t))return o[t];c(t)}function l(e){var n=e.deepStateRedirect;if(!n)return{dsr:false};var r={dsr:true};if(t.isFunction(n))r.fn=n;else if(t.isObject(n))r=t.extend(r,n);if(!r.fn){r.fn=["$dsr$",function(e){return e.redirect.state!=e.to.state}]}return r}function c(e){var t=r.get(e);if(!t)return false;var i=l(t);if(i.dsr){o[t.name]=u;if(s[e]===n)s[e]={}}var f=t.$$state&&t.$$state().parent;if(f){var h=c(f.self.name);if(h&&o[t.name]===n){o[t.name]=a}}return o[t.name]||false}function h(e,r){function i(e){return!e?e:e.toString()}if(r===true)r=Object.keys(e);if(r===null||r===n)r=[];var s={};t.forEach(r.sort(),function(t){s[t]=i(e[t])});return t.toJson(s)}var s={};var o={};var u="Redirect",a="AncestorRedirect";e.$on("$stateChangeStart",function(e,t,n,o,a){if(m||f(t)!==u)return;var c=l(t);var p=h(n,c.params);var d=s[t.name][p];if(!d)return;var v={redirect:{state:d.state,params:d.params},to:{state:t.name,params:n}};var g=i.invoke(c.fn,t,{$dsr$:v});if(!g)return;if(g.state)d=g;e.preventDefault();r.go(d.state,d.params)});e.$on("$stateChangeSuccess",function(e,n,i,o,u){var a=f(n);if(a){var c=n.name;t.forEach(s,function(e,n){var o=l(r.get(n));var u=h(i,o.params);if(c==n||c.indexOf(n+".")!=-1){s[n][u]={state:c,params:t.copy(i)}}})}});return{reset:function(e){if(!e){t.forEach(s,function(e,t){s[t]={}})}else{var n=r.get(e);if(!n)throw new Error("Unknown state: "+e);if(s[n.name])s[n.name]={}}}}}]);t.module("ct.ui.router.extras").run(["$deepStateRedirect",function(e){}]);y.$inject=["$stateProvider"];t.module("ct.ui.router.extras").provider("$stickyState",y);var b;var w={};var E,S=[],x,T,N={hasParamSet:false};t.module("ct.ui.router.extras").run(["$stickyState",function(e){b=e}]);t.module("ct.ui.router.extras").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider",function(e,i,s,o){N.hasParamSet=!!o.ParamSet;T=t.extend(new C("__inactives"),{self:{name:"__inactives"}});E=x=n;S=[];i.decorator("parent",function(e,t){w[e.self.name]=e;e.self.$$state=function(){return w[e.self.name]};if(e.self.sticky===true){s.registerStickyState(e.self)}return t(e)});var a;e.decorator("$state",["$delegate","$log","$q",function(e,i,s){E=e.$current;w[""]=E;E.parent=T;T.parent=n;E.locals=v(T.locals,E.locals);delete T.locals.globals;a=e.transitionTo;e.transitionTo=function(n,o,f){function _(e){var n=t.extend(new C("reactivate_phase1"),{locals:e.locals});n.self=t.extend({},e.self);return n}function D(e){var n=t.extend(new C("reactivate_phase2"),e);var r=n.self.onEnter;n.resolve={};n.views={};n.self.onEnter=function(){n.locals=e.locals;b.stateReactivated(e)};M.addRestoreFunction(function(){e.self.onEnter=r});return n}function P(e){var t=new C("inactivate");t.self=e.self;var n=e.self.onExit;t.self.onExit=function(){b.stateInactivated(e)};M.addRestoreFunction(function(){e.self.onExit=n});return t}function H(e,t){var n=e.self.onEnter;e.self.onEnter=function(){b.stateEntering(e,t,n)};M.addRestoreFunction(function(){e.self.onEnter=n});return e}function B(e){var t=e.self.onExit;e.self.onExit=function(){b.stateExiting(e,N,t)};M.addRestoreFunction(function(){e.self.onExit=t});return e}if(!T.locals)T.locals=E.locals;var l=S.length;if(x){x();if(r){i.debug("Restored paths from pending transition")}}var c=e.$current,h=e.params;var p=f&&f.relative||e.$current;var d=e.get(n,p);var v,m,g;var y=[],N=[],A;var O=function(){};var M=function(){if(v){j.path=v;v=null}if(m){c.path=m;m=null}t.forEach(M.restoreFunctions,function(e){e()});M=O;x=null;S.splice(l,1)};M.restoreFunctions=[];M.addRestoreFunction=function(t){this.restoreFunctions.push(t)};if(d){var j=w[d.name];if(j){v=j.path;m=c.path;var F={toState:j,toParams:o||{},fromState:c,fromParams:h||{},options:f};S.push(F);x=M;g=b.processTransition(F);if(r)k(i,F,g);var I=j.path.slice(0,g.keep);var q=c.path.slice(0,g.keep);t.forEach(T.locals,function(e,t){if(t.indexOf("@")!=-1)delete T.locals[t]});for(var R=0;R<g.inactives.length;R++){var U=g.inactives[R].locals;t.forEach(U,function(e,t){if(U.hasOwnProperty(t)&&t.indexOf("@")!=-1){T.locals[t]=e}})}t.forEach(g.enter,function(e,t){var n;if(e==="reactivate"){n=_(j.path[t]);I.push(n);q.push(n);y.push(D(j.path[t]));A=n}else if(e==="updateStateParams"){n=H(j.path[t]);I.push(n);A=n}else if(e==="enter"){I.push(H(j.path[t]))}});t.forEach(g.exit,function(e,t){var n=c.path[t];if(e==="inactivate"){q.push(P(n));N.push(n)}else if(e==="exit"){q.push(B(n));N.push(n)}});if(y.length){t.forEach(y,function(e){I.push(e)})}if(A){var z=A.self.name+".";var W=b.getInactiveStates();var X=[];W.forEach(function(e){if(e.self.name.indexOf(z)===0){X.push(e)}});X.sort();X.reverse();q=q.concat(u(X,function(e){return B(e)}));N=N.concat(X)}j.path=I;c.path=q;var V=function(e){return(e.surrogateType?e.surrogateType+":":"")+e.self.name};if(r)i.debug("SurrogateFromPath: ",u(q,V));if(r)i.debug("SurrogateToPath:   ",u(I,V))}}var $=a.apply(e,arguments);return $.then(function(n){M();if(r)L(i,w[n.name],e);n.status="active";return n},function(t){M();if(r&&t.message!=="transition prevented"&&t.message!=="transition aborted"&&t.message!=="transition superseded"){i.debug("transition failed",t);console.log(t.stack)}return s.reject(t)})};return e}])}]);t.module("ct.ui.router.extras").provider("$futureState",["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider",function(n,r,i){function h(e,n){var r=t.isObject(e)?e.name:e;return!n?w[r]:o[r]}function p(e,t){if(t.name){var n=t.name.split(/\./);if(t.name.charAt(0)===".")n[0]=e.current.name;while(n.length){var r=n.join(".");if(e.get(r,{relative:e.current}))return null;if(o[r])return o[r];n.pop()}}if(t.url){var i=[];for(var s in o){if(o[s].urlMatcher.exec(t.url)){i.push(o[s])}}var u=i.slice(0);for(var a=i.length-1;a>=0;a--){for(var f=0;f<u.length;f++){if(i[a]===u[f].parentFutureState)i.splice(a,1)}}return i[0]}}function d(e,t){var n=e.get("$q");if(!t){var r=n.defer();r.reject("No lazyState passed in "+t);return r.promise}var i=n.when([]),u=t.parentFutureState;if(u&&o[u.name]){i=d(e,o[u.name])}var a=t.type;var f=s[a];if(!f)throw Error("No state factory for futureState.type: "+(t&&t.type));return i.then(function(n){var r=e.invoke(f,f,{futureState:t});return r.then(function(e){if(e){n.push(e)}return n})})["finally"](function(){delete o[t.name]})}function m(e,t){var r=false;var i=["$rootScope","$urlRouter","$state",function(s,o,a){if(!l){f().then(function(){r=true;o.sync();r=false});l=true;return}var c=p(a,{url:t.path()});if(!c){return e.invoke(v)}u=true;d(e,c).then(function(t){t.forEach(function(e){if(e&&(!a.get(e)||e.name&&!a.get(e.name)))n.state(e)});r=true;o.sync();r=false;u=false},function(){u=false;return e.invoke(v)})}];if(u)return;var s=r?v:i;return e.invoke(s)}var s={},o={};var u=false,a=[],f,l=false;var c=this;this.addResolve=function(e){a.push(e)};this.stateFactory=function(e,t){s[e]=t};this.futureState=function(e){if(e.stateName)e.name=e.stateName;if(e.urlPrefix)e.url="^"+e.urlPrefix;o[e.name]=e;var n,r=e.name.split(/\./).slice(0,-1).join("."),s=h(e.parent||r);if(r===""){n=i.compile("")}else if(s){n=s.navigable.url}else if(r===""){n=i.compile("")}else{var u=h(e.parent||r,true);if(!u)throw new Error("Couldn't determine parent state of future state. FutureState:"+t.toJson(e));var a=u.urlMatcher.source.replace(/\*rest$/,"");n=i.compile(a);e.parentFutureState=u}e.urlMatcher=e.url.charAt(0)==="^"?i.compile(e.url.substring(1)+"*rest"):n.concat(e.url+"*rest")};this.get=function(){return t.extend({},o)};var v=["$log","$location",function(t,n){t.debug("Unable to map "+n.path())}];r.otherwise(m);r.otherwise=function(e){if(t.isString(e)){var n=e;e=function(){return n}}else if(!t.isFunction(e))throw new Error("'rule' must be a function");v=e;return r};var g={getResolvePromise:function(){return f()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(r,i,s,o,l,h,v){function m(){o.$on("$stateNotFound",function(t,s,o,a){if(u)return;v.debug("event, unfoundState, fromState, fromParams",t,s,o,a);var f=p(i,{name:s.to});if(!f)return;t.preventDefault();u=true;var l=d(r,f);l.then(function(e){e.forEach(function(e){if(e&&(!i.get(e)||e.name&&!i.get(e.name)))n.state(e)});i.go(s.to,s.toParams);u=false},function(e){console.log("failed to lazy load state ",e);i.go(o,a);u=false})});if(!f){var e=[];t.forEach(a,function(t){e.push(r.invoke(t))});f=function(){return s.all(e)}}f().then(function(){h(function(){if(i.transition){i.transition.then(l.sync,l.sync)}else{l.sync()}})})}m();g.state=n.state;g.futureState=c.futureState;g.get=c.get;return g}]}]);t.module("ct.ui.router.extras").run(["$futureState",function(e){}]);t.module("ct.ui.router.extras").service("$previousState",["$rootScope","$state",function(e,t){var n=null;var r={};var i=null;e.$on("$stateChangeStart",function(e,t,r,s,o){i=n;n={state:s,params:o}});e.$on("$stateChangeError",function(){n=i;i=null});e.$on("$stateChangeSuccess",function(){i=null});var s={get:function(e){return e?r[e]:n},go:function(e,n){var r=s.get(e);return t.go(r.state,r.params,n)},memo:function(e,i,s){r[e]=n||{state:t.get(i),params:s}},forget:function(e){delete r[e]}};return s}]);t.module("ct.ui.router.extras").run(["$previousState",function(e){}]);t.module("ct.ui.router.extras").config(["$provide",function(e){e.decorator("$state",["$delegate","$rootScope","$q","$injector",function(e,n,r,i){function f(e){var n=i.invoke;var r=i.instantiate;i.invoke=function(r,i,s){return n(r,i,t.extend({$transition$:e},s))};i.instantiate=function(n,i){return r(n,t.extend({$transition$:e},i))};return function(){i.invoke=n;i.instantiate=r}}function l(){a.pop()();u.pop();o--}function c(e,t){return function(i){l();n.$broadcast("$transitionSuccess",t);return e.resolve(i)}}function h(e,t){return function(i){l();n.$broadcast("$transitionError",t,i);return e.reject(i)}}var s=e.transitionTo;var o=-1;var u=[];var a=[];e.transitionTo=function(t,n,i){var f=r.defer();var l=u[++o]={promise:f.promise};a[o]=function(){};var p=s.apply(e,arguments);return p.then(c(f,l),h(f,l))};n.$on("$stateChangeStart",function(e,r,i,s,l){var c=o;var h=t.extend(u[c],{to:{state:r,params:i},from:{state:s,params:l}});var p=f(h);a[c]=p;n.$broadcast("$transitionStart",h)});return e}])}])})(window,window.angular)